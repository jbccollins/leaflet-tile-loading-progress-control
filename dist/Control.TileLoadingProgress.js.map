{"version":3,"file":"Control.TileLoadingProgress.js","sources":["../src/control.js","../src/index.js"],"sourcesContent":["import L from 'leaflet';\nexport default {\n    class: L.Control.extend({\n        options: {\n            leafletElt: null,\n            position: 'topright'\n        },\n        initialize: function (options) {\n            this.handleLoadingStatusUpdate = this.handleLoadingStatusUpdate.bind(this);\n            this.handleTileLoad = this.handleTileLoad.bind(this);\n            this.handleLayerLoading = this.handleLayerLoading.bind(this);\n            this.handleTileError = this.handleTileError.bind(this);\n            this.getTileStatusCounts = this.getTileStatusCounts.bind(this);\n            L.Util.setOptions(this, options);\n        },\n        onAdd: function (map) {\n            var leafletElt = this.options.leafletElt;\n            var controlInstance = this;\n            var container = L.DomUtil.create('div', 'leaflet-control-progress-bar');\n            var loadingContainer = L.DomUtil.create('div', 'loading-container');\n            var loadingBackground = L.DomUtil.create('div', 'loading-background');\n            var loadingForeground = L.DomUtil.create('div', 'loading-foreground');\n            var loadingText = L.DomUtil.create('div', 'loading-text');\n            loadingContainer.appendChild(loadingBackground);\n            loadingContainer.appendChild(loadingForeground);\n            container.appendChild(loadingContainer);\n            container.appendChild(loadingText);\n            map.on('layeradd', function(e) {\n                var currentLayers = leafletElt.getLayers();\n                for (var i = 0; i < currentLayers.length; i++) {\n                    // If the layer added to the map is part of the layer group then we rebind the loading triggers.\n                    if (currentLayers[i] === e.layer) {\n                        controlInstance.unbindLoadEventTriggers();\n                        controlInstance.bindLoadEventTriggers();\n                        controlInstance.handleLoadingStatusUpdate();\n                        break;\n                    }\n                }\n            });\n            this.bindLoadEventTriggers();\n            this.loadingForegroundElt = loadingForeground;\n            this.container = container;\n            this.loadingText = loadingText;\n            return container;\n        },\n        unbindLoadEventTriggers: function() {\n            for (var key in this.options.leafletElt._layers) {\n                var layer = this.options.leafletElt._layers[key];\n                layer.off('tileload', this.handleTileLoad);\n                layer.off('loading', this.handleLayerLoading);\n                layer.off('tileerror', this.handleTileError);\n            }\n        },\n        bindLoadEventTriggers: function() {\n            for (var key in this.options.leafletElt._layers) {\n                var layer = this.options.leafletElt._layers[key];\n                layer.on('tileload', this.handleTileLoad);\n                layer.on('loading', this.handleLayerLoading);\n                layer.on('tileerror', this.handleTileError);\n            }\n        },\n        handleLoadingStatusUpdate: function () {\n            var status = {\n                loading: 0,\n                loaded: 0\n            }\n            for (var key in this.options.leafletElt._layers) {\n                var layer = this.options.leafletElt._layers[key];\n                var layerStatus = this.getTileStatusCounts(layer);\n                status.loading += layerStatus.loading;\n                status.loaded += layerStatus.loaded;\n            }\n            var numTiles = status.loading + status.loaded;\n            var w = numTiles ? status.loaded / numTiles : 0;\n            var percent = w * 100;\n            this.loadingForegroundElt.style.width = percent + \"%\"\n            if (w === 1) {\n                this.container.style.opacity = 0;\n            } else {\n                this.container.style.opacity = 1;\n            }\n            this.loadingText.innerHTML = \"Loading Tiles (\" + Math.floor(percent) + \"%)\";\n        },\n        handleLayerLoading: function () {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileLoad: function () {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileError: function () {\n            this.handleLoadingStatusUpdate();\n        },\n        getTileStatusCounts: function (l) {\n            var status = {\n                loaded: 0,\n                loading: 0,\n            }\n            for (var key in l._tiles) {\n                if (l._tiles[key].loaded) {\n                    status.loaded++;\n                } else {\n                    status.loading++;\n                }\n            }\n            return status;\n        }\n    }),\n    factory: function(options) {\n        return new L.Control.TileLoadingProgress(options);\n    }\n};","import L from 'leaflet';\nimport Control from './control';\n\nvar TileLoadingProgress = L.Util.extend(Control.class, {});\n\nexport default TileLoadingProgress;\n\nL.Util.extend(L.Control, {\n  TileLoadingProgress: TileLoadingProgress,\n  tileLoadingProgress: Control.factory\n});"],"names":[],"mappings":"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"}