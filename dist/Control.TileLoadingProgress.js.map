{"version":3,"file":"Control.TileLoadingProgress.js","sources":["../src/control.js","../src/index.js"],"sourcesContent":["import L from 'leaflet';\r\nexport default {\r\n    class: L.Control.extend({\r\n        options: {\r\n            leafletElt: null,\r\n            position: 'topright'\r\n        },\r\n        initialize: function (options) {\r\n            this.handleLoadingStatusUpdate = this.handleLoadingStatusUpdate.bind(this);\r\n            this.handleTileLoad = this.handleTileLoad.bind(this);\r\n            this.handleLayerLoading = this.handleLayerLoading.bind(this);\r\n            this.handleTileError = this.handleTileError.bind(this);\r\n            this.getTileStatusCounts = this.getTileStatusCounts.bind(this);\r\n            L.Util.setOptions(this, options);\r\n        },\r\n        onAdd: function (map) {\r\n            var leafletElt = this.options.leafletElt;\r\n            var controlInstance = this;\r\n            var container = L.DomUtil.create('div', 'leaflet-control-progress-bar');\r\n            var loadingContainer = L.DomUtil.create('div', 'loading-container');\r\n            var loadingBackground = L.DomUtil.create('div', 'loading-background');\r\n            var loadingForeground = L.DomUtil.create('div', 'loading-foreground');\r\n            var loadingText = L.DomUtil.create('div', 'loading-text');\r\n            loadingContainer.appendChild(loadingBackground);\r\n            loadingContainer.appendChild(loadingForeground);\r\n            container.appendChild(loadingContainer);\r\n            container.appendChild(loadingText);\r\n            map.on('layeradd', function(e) {\r\n                var currentLayers = leafletElt.getLayers();\r\n                for (var i = 0; i < currentLayers.length; i++) {\r\n                    // If the layer added to the map is part of the layer group then we rebind the loading triggers.\r\n                    if (currentLayers[i] === e.layer) {\r\n                        controlInstance.unbindLoadEventTriggers();\r\n                        controlInstance.bindLoadEventTriggers();\r\n                        controlInstance.handleLoadingStatusUpdate();\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n            this.bindLoadEventTriggers();\r\n            this.loadingForegroundElt = loadingForeground;\r\n            this.container = container;\r\n            this.loadingText = loadingText;\r\n            return container;\r\n        },\r\n        unbindLoadEventTriggers: function() {\r\n            for (var key in this.options.leafletElt._layers) {\r\n                var layer = this.options.leafletElt._layers[key];\r\n                layer.off('tileload', this.handleTileLoad);\r\n                layer.off('loading', this.handleLayerLoading);\r\n                layer.off('tileerror', this.handleTileError);\r\n            }\r\n        },\r\n        bindLoadEventTriggers: function() {\r\n            for (var key in this.options.leafletElt._layers) {\r\n                var layer = this.options.leafletElt._layers[key];\r\n                layer.on('tileload', this.handleTileLoad);\r\n                layer.on('loading', this.handleLayerLoading);\r\n                layer.on('tileerror', this.handleTileError);\r\n            }\r\n        },\r\n        handleLoadingStatusUpdate: function () {\r\n            var status = {\r\n                loading: 0,\r\n                loaded: 0\r\n            }\r\n            for (var key in this.options.leafletElt._layers) {\r\n                var layer = this.options.leafletElt._layers[key];\r\n                var layerStatus = this.getTileStatusCounts(layer);\r\n                status.loading += layerStatus.loading;\r\n                status.loaded += layerStatus.loaded;\r\n            }\r\n            var numTiles = status.loading + status.loaded;\r\n            var w = numTiles ? status.loaded / numTiles : 0;\r\n            var percent = w * 100;\r\n            this.loadingForegroundElt.style.width = percent + \"%\"\r\n            if (w === 1) {\r\n                this.container.style.opacity = 0;\r\n            } else {\r\n                this.container.style.opacity = 1;\r\n            }\r\n            this.loadingText.innerHTML = \"Loading Tiles (\" + Math.floor(percent) + \"%)\";\r\n        },\r\n        handleLayerLoading: function () {\r\n            this.handleLoadingStatusUpdate();\r\n        },\r\n        handleTileLoad: function () {\r\n            this.handleLoadingStatusUpdate();\r\n        },\r\n        handleTileError: function () {\r\n            this.handleLoadingStatusUpdate();\r\n        },\r\n        getTileStatusCounts: function (l) {\r\n            var status = {\r\n                loaded: 0,\r\n                loading: 0,\r\n            }\r\n            for (var key in l._tiles) {\r\n                if (l._tiles[key].loaded) {\r\n                    status.loaded++;\r\n                } else {\r\n                    status.loading++;\r\n                }\r\n            }\r\n            return status;\r\n        }\r\n    }),\r\n    factory: function(options) {\r\n        return new L.Control.TileLoadingProgress(options);\r\n    }\r\n};","import L from 'leaflet';\r\nimport Control from './control';\r\n\r\nvar TileLoadingProgress = L.Util.extend(Control.class, {});\r\n\r\nexport default TileLoadingProgress;\r\n\r\nL.Util.extend(L.Control, {\r\n  TileLoadingProgress: TileLoadingProgress,\r\n  tileLoadingProgress: Control.factory\r\n});"],"names":[],"mappings":"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"}