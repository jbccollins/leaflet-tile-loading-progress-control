{"version":3,"file":"Control.TileLoadingProgress.js","sources":["../src/control.js","../src/index.js"],"sourcesContent":["import L from 'leaflet';\nexport default {\n    class: L.Control.extend({\n        options: {\n            leafletElt: null,\n            position: 'topright'\n        },\n        initialize: function (options) {\n            // constructor\n            this.handleLoadingStatusUpdate = this.handleLoadingStatusUpdate.bind(this);\n            this.handleTileLoadStart = this.handleTileLoadStart.bind(this);\n            this.handleTileUnload = this.handleTileUnload.bind(this);\n            this.handleTileLoad = this.handleTileLoad.bind(this);\n            this.handleLayerLoading = this.handleLayerLoading.bind(this);\n            this.handleTileError = this.handleTileError.bind(this);\n            this.handleLayerLoad = this.handleLayerLoad.bind(this);\n            this.getTileStatusCounts = this.getTileStatusCounts.bind(this);\n            L.Util.setOptions(this, options);\n        },\n        onAdd: function (map) {\n            var container = L.DomUtil.create('div', 'leaflet-control-progress-bar loading-container');\n            var loadingBackground = L.DomUtil.create('div', 'loading-background');\n            var loadingForeground = L.DomUtil.create('div', 'loading-foreground');\n            container.appendChild(loadingBackground);\n            container.appendChild(loadingForeground);\n            for (var key in this.options.leafletElt._layers) {\n            var layer = this.options.leafletElt._layers[key];\n            layer.on('tileloadstart', this.handleTileLoadStart);\n            layer.on('tileunload', this.handleTileUnload);\n            layer.on('tileload', this.handleTileLoad);\n            layer.on('loading', this.handleLayerLoading);\n            layer.on('tileerror', this.handleTileError);\n            layer.on('load', this.handleLayerLoad);\n            }\n            this.loadingForegroundElt = loadingForeground;\n            return container;\n        },\n        onRemove: function (map) {\n            // when removed\n        },\n        handleLoadingStatusUpdate: function () {\n            var status = null;\n            var status = {\n            loading: 0,\n            loaded: 0\n            }\n            for (var key in this.options.leafletElt._layers) {\n            var layer = this.options.leafletElt._layers[key];\n            var layerStatus = this.getTileStatusCounts(layer);\n            status.loading += layerStatus.loading;\n            status.loaded += layerStatus.loaded;\n            }\n            var numTiles = status.loading + status.loaded;\n            var w = numTiles ? status.loaded / numTiles : 0; \n            this.loadingForegroundElt.style.width = (w * 100) + \"%\";\n        },\n        handleLayerLoading: function (e) {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileLoadStart: function (e) {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileLoad: function (e) {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileError: function (e) {\n            this.handleLoadingStatusUpdate();\n        },\n        handleTileUnload: function (e) {\n            this.handleLoadingStatusUpdate();\n        },\n        handleLayerLoad: function (e) {\n            //console.log('loaded');\n        },\n        getTileStatusCounts: function (l) {\n            var status = {\n            loaded: 0,\n            loading: 0,\n            }\n                for (var key in l._tiles) {\n            if (l._tiles[key].loaded) {\n                status.loaded++;\n            } else {\n                status.loading++;\n            }\n                }\n                return status;\n        }\n    }),\n    factory: function(options) {\n        return new L.Control.TileLoadingProgress(options);\n    }\n};","import L from 'leaflet';\nimport Control from './control';\n\nvar TileLoadingProgress = L.Util.extend(Control.class, {});\n\nexport default TileLoadingProgress;\n\nL.Util.extend(L.Control, {\n  TileLoadingProgress: TileLoadingProgress,\n  tileLoadingProgress: Control.factory\n});"],"names":[],"mappings":"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"}